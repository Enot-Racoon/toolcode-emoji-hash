/**
 * emojiHash
 *
 * Generates a short, deterministic emoji string from any input value.
 * Useful for visually distinguishing objects in debug logs without
 * relying on hard-to-read IDs or hashes.
 *
 * Algorithm:
 *   1. Converts input to string and hashes it with FNV-1a 32-bit.
 *   2. At depth=64, computes a second FNV-1a pass with a different seed
 *      to form a 64-bit state, eliminating birthday collisions up to ~4B entries.
 *   3. Seeds an xorshift PRNG with the hash state.
 *   4. For each output position, draws two random numbers:
 *      one to select an emoji group, one to select an emoji within it.
 *
 * Collision characteristics:
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚ Max entries â”‚ length â”‚  depth  â”‚ Collision probability â”‚
 *   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 *   â”‚     100 000 â”‚   3    â”‚   32    â”‚ < 0.1%               â”‚
 *   â”‚   1 000 000 â”‚   4    â”‚   32    â”‚ < 0.1%               â”‚
 *   â”‚  16 000 000 â”‚   4    â”‚   64    â”‚ < 0.01%              â”‚
 *   â”‚ 1 000 000 000â”‚  5    â”‚   64    â”‚ < 0.01%              â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * @param {*}      input          - Any value; will be coerced to string.
 * @param {object} [options]
 * @param {number} [options.length=4]  - Number of emoji in the output (1â€“8).
 * @param {number} [options.depth=32]  - Hash depth in bits. Either 32 or 64.
 *                                       Use 64 for datasets larger than ~1 million entries.
 * @returns {string} A deterministic emoji string, e.g. "ğŸ¯ğŸŒŠğŸ˜ğŸ•"
 *
 * @example
 * emojiId("user-1337")                      // "ğŸ¯ğŸŒŠğŸ˜ğŸ•"
 * emojiId("user-1337")                      // "ğŸ¯ğŸŒŠğŸ˜ğŸ•" (same input â†’ same output)
 * emojiId("user-1338")                      // "ğŸ‡ğŸ¤–ğŸŒ™ğŸ”‘" (different input â†’ different output)
 * emojiId(42, { length: 3 })               // "ğŸ˜‚ğŸ˜âš¡"
 * emojiId("session-xyz", { depth: 64 })    // safe up to ~16M entries
 */
const emojiHash = (input, { length = 4, depth = 32 } = {}) => {
  const str = String(input)

  const fnv32 = (seed) => {
    let h = seed
    for (let i = 0; i < str.length; i++) {
      h ^= str.charCodeAt(i)
      h = Math.imul(h, 0x01000193)
    }
    return h >>> 0
  }

  let x = fnv32(0x811c9dc5) || 0xdeadbeef
  let y = fnv32(0xc4ceb9fe) || 0xbeefdead

  const rnd = depth === 64
    ? () => {
        let t = x ^ (x << 11)
        x = y
        y ^= (y >>> 19) ^ t ^ (t >>> 8)
        return y >>> 0
      }
    : () => {
        x ^= x << 13
        x ^= x >>> 17
        x ^= x << 5
        return x >>> 0
      }

  const pick = (arr) => {
    const n = arr.length
    const limit = (0x100000000 / n | 0) * n
    let r
    do { r = rnd() } while (r >= limit)
    return arr[r % n]
  }

  const EMOTION = [
    "ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ˜‚","ğŸ¤£",
    "ğŸ™‚","ğŸ™ƒ","ğŸ˜‰","ğŸ˜Š","ğŸ˜‡","ğŸ¥°","ğŸ˜","ğŸ¤©",
    "ğŸ˜˜","ğŸ˜—","ğŸ˜š","ğŸ˜‹","ğŸ˜œ","ğŸ¤ª","ğŸ˜","ğŸ¤“",
    "ğŸ§","ğŸ¤ ","ğŸ¥³","ğŸ˜¤","ğŸ˜ ","ğŸ˜¡","ğŸ¤¬","ğŸ˜”",
    "ğŸ˜•","ğŸ™","â˜¹ï¸","ğŸ˜£","ğŸ˜–","ğŸ˜«","ğŸ˜©","ğŸ¥º",
    "ğŸ˜¢","ğŸ˜­","ğŸ˜³","ğŸ¥´","ğŸ˜µ","ğŸ¤¯","ğŸ˜±","ğŸ˜¨",
    "ğŸ˜°","ğŸ˜¥","ğŸ˜“","ğŸ¤—","ğŸ¤­","ğŸ¤«","ğŸ¤”","ğŸ¤",
    "ğŸ¤¢","ğŸ¤®","ğŸ¤§","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ¥¶","ğŸ¥µ"
  ]

  const ANIMAL = [
    "ğŸ¶","ğŸ±","ğŸ­","ğŸ¹","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼",
    "ğŸ¨","ğŸ¯","ğŸ¦","ğŸ®","ğŸ·","ğŸ¸","ğŸµ","ğŸ”",
    "ğŸ§","ğŸ¦","ğŸ¤","ğŸ¦†","ğŸ¦…","ğŸ¦‰","ğŸ¦‡","ğŸº",
    "ğŸ—","ğŸ´","ğŸ¦„","ğŸ","ğŸ›","ğŸ¦‹","ğŸŒ","ğŸ",
    "ğŸœ","ğŸ¦—","ğŸ¢","ğŸ","ğŸ¦","ğŸ¦–","ğŸ¦•","ğŸ™",
    "ğŸ¦‘","ğŸ¦","ğŸ¦","ğŸ¦€","ğŸ¡","ğŸ ","ğŸŸ","ğŸ¬",
    "ğŸ³","ğŸ‹","ğŸ¦ˆ","ğŸŠ","ğŸ…","ğŸ†","ğŸ¦“","ğŸ¦",
    "ğŸ˜","ğŸ¦›","ğŸ¦","ğŸª","ğŸ«","ğŸ¦’","ğŸ¦˜","ğŸ¦¬"
  ]

  const NATURE = [
    "ğŸŒµ","ğŸŒ´","ğŸŒ²","ğŸŒ³","ğŸŒ±","ğŸŒ¿","â˜˜ï¸","ğŸ€",
    "ğŸ","ğŸª´","ğŸ‹","ğŸƒ","ğŸ‚","ğŸ","ğŸŒ¾","ğŸŒº",
    "ğŸŒ»","ğŸŒ¼","ğŸŒ·","ğŸŒ¹","ğŸ¥€","ğŸª·","ğŸŒ¸","ğŸ’",
    "ğŸŒ","ğŸŒ","ğŸŒ›","ğŸŒœ","ğŸŒš","ğŸŒ•","ğŸŒ–","ğŸŒ—",
    "ğŸŒ˜","ğŸŒ‘","ğŸŒ’","ğŸŒ“","ğŸŒ”","ğŸŒ™","â­","ğŸŒŸ",
    "âœ¨","âš¡","â˜„ï¸","ğŸ’«","ğŸŒªï¸","ğŸŒˆ","â˜€ï¸","â›…",
    "â˜ï¸","ğŸŒ¦ï¸","ğŸŒ§ï¸","ğŸŒ©ï¸","ğŸŒ¨ï¸","â„ï¸","â›„","ğŸŒ¬ï¸",
    "ğŸ’¨","ğŸŒŠ","ğŸ’§","ğŸ”¥","ğŸŒ","ğŸŒ","ğŸŒ","ğŸª"
  ]

  const FOOD = [
    "ğŸ","ğŸ","ğŸ","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ‰","ğŸ‡",
    "ğŸ“","ğŸ«","ğŸ’","ğŸ‘","ğŸ¥­","ğŸ","ğŸ¥¥","ğŸ¥",
    "ğŸ…","ğŸ†","ğŸ¥‘","ğŸ¥¦","ğŸ¥¬","ğŸ¥’","ğŸŒ¶ï¸","ğŸ«‘",
    "ğŸŒ½","ğŸ¥•","ğŸ§„","ğŸ§…","ğŸ¥”","ğŸ ","ğŸ","ğŸ¥",
    "ğŸ¥–","ğŸ¥¨","ğŸ¥¯","ğŸ§€","ğŸ¥š","ğŸ³","ğŸ¥","ğŸ§‡",
    "ğŸ¥“","ğŸ”","ğŸŸ","ğŸ•","ğŸŒ­","ğŸ¥ª","ğŸŒ®","ğŸŒ¯",
    "ğŸ¥™","ğŸ§†","ğŸ¥—","ğŸ","ğŸœ","ğŸ²","ğŸ›","ğŸ£",
    "ğŸ±","ğŸ¥Ÿ","ğŸ¤","ğŸ™","ğŸš","ğŸ˜","ğŸ¡","ğŸ§"
  ]

  const OBJECT = [
    "âŒš","ğŸ“±","ğŸ’»","âŒ¨ï¸","ğŸ–¥ï¸","ğŸ–±ï¸","ğŸ’¾","ğŸ’¿",
    "ğŸ“·","ğŸ“¹","ğŸ¥","ğŸ“","â˜ï¸","ğŸ“º","ğŸ“»","ğŸ§",
    "ğŸ¤","ğŸµ","ğŸ¶","ğŸ¹","ğŸ¸","ğŸ¥","ğŸ·","ğŸº",
    "ğŸ»","ğŸª•","ğŸ®","ğŸ•¹ï¸","ğŸ²","â™Ÿï¸","ğŸ§©","ğŸ§¸",
    "ğŸª†","ğŸ’¡","ğŸ”¦","ğŸ•¯ï¸","ğŸ› ï¸","âš™ï¸","ğŸ”©","ğŸ§²",
    "ğŸ§ª","ğŸ§«","ğŸ§¬","ğŸ”¬","ğŸ”­","ğŸ“¡","ğŸ’Š","ğŸ’‰",
    "ğŸ©¹","ğŸ©º","ğŸ“š","ğŸ“–","âœï¸","ğŸ–Šï¸","ğŸ“","ğŸ“",
    "ğŸ”‘","ğŸ—ï¸","ğŸ”","ğŸ”’","ğŸ”“","ğŸ§°","ğŸª¤","ğŸ"
  ]

  const VEHICLE = [
    "ğŸš—","ğŸš•","ğŸš™","ğŸšŒ","ğŸš","ğŸï¸","ğŸš“","ğŸš‘",
    "ğŸš’","ğŸš","ğŸ›»","ğŸšš","ğŸš›","ğŸšœ","ğŸï¸","ğŸ›µ",
    "ğŸš²","ğŸ›´","ğŸš¨","ğŸšƒ","ğŸš‹","ğŸš","ğŸš","ğŸš„",
    "ğŸš…","ğŸšˆ","ğŸš‚","ğŸš†","ğŸš‡","ğŸšŠ","ğŸš‰","âœˆï¸",
    "ğŸ›«","ğŸ›¬","ğŸ›©ï¸","ğŸš€","ğŸ›°ï¸","ğŸ›¸","ğŸš","â›µ",
    "ğŸš¤","ğŸ›¥ï¸","ğŸ›³ï¸","ğŸš¢","âš“","ğŸª‚","ğŸ›¶","ğŸ„",
    "ğŸš£","ğŸ§—","ğŸ•ï¸","ğŸ—ºï¸","ğŸ§­","ğŸ”ï¸","ğŸ—»","ğŸŒ‹",
    "ğŸ–ï¸","ğŸœï¸","ğŸï¸","ğŸï¸","ğŸŒ","ğŸŒƒ","ğŸŒ†","ğŸŒ‡"
  ]

  const SYMBOL = [
    "â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ–¤","ğŸ¤",
    "ğŸ¤","ğŸ’”","ğŸ’•","ğŸ’","ğŸ’“","ğŸ’—","ğŸ’–","ğŸ’˜",
    "ğŸ’","â˜®ï¸","âœï¸","â˜ªï¸","ğŸ•‰ï¸","â˜¸ï¸","âœ¡ï¸","â˜¯ï¸",
    "â™ˆ","â™‰","â™Š","â™‹","â™Œ","â™","â™","â™",
    "â™","â™‘","â™’","â™“","ğŸ”´","ğŸŸ ","ğŸŸ¡","ğŸŸ¢",
    "ğŸ”µ","ğŸŸ£","âš«","âšª","ğŸŸ¤","ğŸ”¶","ğŸ”·","ğŸ”¸",
    "ğŸ”¹","ğŸ”º","ğŸ”»","ğŸ’ ","ğŸ”˜","ğŸ”²","ğŸ”³","â–ªï¸",
    "â–«ï¸","ğŸ","ğŸš©","ğŸŒ","ğŸ´","ğŸ³ï¸","â™»ï¸","ğŸ”±"
  ]

  const GROUPS = [EMOTION, ANIMAL, NATURE, FOOD, OBJECT, VEHICLE, SYMBOL]

  let out = ""
  for (let i = 0; i < length; i++) {
    out += pick(pick(GROUPS))
  }

  return out
}

module.exports = emojiHash
module.exports.default = emojiHash
